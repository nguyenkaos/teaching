\lstset{basicstyle=\scriptsize\ttfamily,frame=none,aboveskip=0bp,breaklines=true,belowskip=0bp,language=C++,showspaces=false, showstringspaces=false}\defverbatim[colored]\lsttagdispatchingtag{%
\begin{lstlisting}
namespace std 
{
  struct input_iterator_tag {};
  struct bidirectional_iterator_tag : input_iterator_tag {};
  struct random_access_iterator_tag 
       : bidirectional_iterator_tag {};
}
\end{lstlisting}}

\lstset{basicstyle=\scriptsize\ttfamily,frame=none,aboveskip=0bp,breaklines=true,belowskip=0bp,language=C++,showspaces=false, showstringspaces=false}\defverbatim[colored]\lsttagdispatchingfunctioninput{%
\begin{lstlisting}
namespace std 
{
  namespace detail 
  {
    template <class InputIterator, class Distance>
    void advance_dispatch( InputIterator& i
                         , Distance n
                         , input_iterator_tag const&
                         ) 
    {
      assert(n >=0);
      while (n--) ++i;
    }
  }
}
\end{lstlisting}}


\lstset{basicstyle=\scriptsize\ttfamily,frame=none,aboveskip=0bp,breaklines=true,belowskip=0bp,language=C++,showspaces=false, showstringspaces=false}\defverbatim[colored]\lsttagdispatchingfunctionbi{%
\begin{lstlisting}
namespace std 
{
  namespace detail 
  {
    template <class BidirectionalIterator, class Distance>
    void advance_dispatch( BidirectionalIterator& i
                         , Distance n
                         , bidirectional_iterator_tag const&
                         ) 
    {
      if (n >= 0)
        while (n--) ++i;
      else
        while (n++) --i;
    }
  }
}
\end{lstlisting}}

\lstset{basicstyle=\scriptsize\ttfamily,frame=none,aboveskip=0bp,breaklines=true,belowskip=0bp,language=C++,showspaces=false, showstringspaces=false}\defverbatim[colored]\lsttagdispatchingfunctionrandom{%
\begin{lstlisting}
namespace std 
{
  namespace detail 
  {
    template <class RandomAccessIterator, class Distance>
    void advance_dispatch( RandomAccessIterator& i
                         , Distance n
                         , random_access_iterator_tag const&
                         ) 
    {
      i += n;
    }
  }
}
\end{lstlisting}}


\lstset{basicstyle=\scriptsize\ttfamily,frame=none,aboveskip=0bp,breaklines=true,belowskip=0bp,language=C++,showspaces=false, showstringspaces=false}\defverbatim[colored]\lsttagdispatchingfunctionmain{%
\begin{lstlisting}
namespace std 
{
  template <class InputIterator, class Distance>
  void advance(InputIterator& i, Distance n) 
  {
    typename iterator_traits<InputIterator>::iterator_category category;
    detail::advance_dispatch(i, n, category);
  }
}
\end{lstlisting}}

% !TEX encoding = UTF-8 Unicode
% -*- coding: UTF-8; -*-
% vim: set fenc=utf-8
\documentclass[svgnames]{beamer}
\setlength{\tabcolsep}{3em}
\usetheme[pageofpages=of,% String used between the current page and the
                         % total page count.
          titleline=true,
          alternativetitlepage=true% Use the fancy title page.
          ]{Torino}
\usecolortheme{metascale}
\usepackage{listings}

\ifxetex
  \usepackage{fontspec}
  \defaultfontfeatures{Mapping=tex-text}
  \setsansfont[ItalicFont={GillSansMTPro-BookItalic}]{GillSansMTPro-Book}
  \setmonofont{Inconsolata}
  \newcommand{\codefont}{\ttfamily}
\else
  \usepackage[utf8x]{inputenc}
  %\usepackage[nott]{inconsolata}
  %\newcommand{\codefont}{\fontfamily{fi4}\selectfont}
  \usepackage{inconsolata}
  \newcommand{\codefont}{\ttfamily}
\fi
\usepackage{graphicx}
\usepackage{color}
%\usepackage{multicol}
%\usepackage{array}
%\usepackage{colortbl}
\usepackage[frenchb]{babel}
%\usepackage{pgfplots}
%\usepackage{standalone}
\usepackage{relsize}

% setup tikz
%% \usepackage{tikz}
%% \usetikzlibrary{calc,trees,positioning,arrows,chains,shapes.geometric,%
%% decorations.pathreplacing,decorations.pathmorphing,shapes,%
%% matrix,shapes.symbols,plotmarks,decorations.markings,shadows,%
%% snakes,backgrounds}
\def\print#1{\pgfmathparse{#1}\pgfmathresult}
\def\colx{Blue!40}
\def\coly{Blue!20}
\def\colz{white}

\def\C++{\textup{C}\nolinebreak[4]\hspace{-.05em}\raisebox{.4ex}{\relsize{-3}{\textbf{++}}}}

% vertical align box
\newcommand*{\vcenteredhbox}[1]{\begingroup
\setbox0=\hbox{#1}\parbox{\wd0}{\box0}\endgroup}

\lstdefinestyle{customcpp}{language=C++,
        basicstyle=\tiny\codefont,
        tabsize=2,
        numberstyle=\footnotesize,
        showstringspaces=false,
        %columns=fullflexible,
        keywordstyle=\color[rgb]{0.64,0.13,0.11},
        identifierstyle=,
        commentstyle=\color[rgb]{0.27,0.27,0.28},
        stringstyle=\color[rgb]{0.82,0.16,0.14},
        morekeywords=noexcept
        }

\definecolor{hlcolor}{rgb}{0.88,0.88,0.88}
\pgfdeclareimage[interpolate=true,width=9cm]{move}{move}


\NoAutoSpaceBeforeFDP

\title{Programmation C++ Avancée}
\subtitle{Session 7 -- Méta-programmation}
\author{Joel Falcou \and Guillaume Melquiond}
\institute{Laboratoire de Recherche en Informatique}
\date{}

\subject{Computer Science}

\begin{document}
\include{sourcecode}
\include{slidelst}

\begin{frame}[plain]
\titlepage
\end{frame}
\setcounter{framenumber}{0}

\frame
{
  \frametitle{Les \texttt{templates} en C++11/14}

  \begin{block}{Nouvelles fonctionnalités}
  \begin{itemize}
  \item La fin du cauchemar des \texttt{>>}
  \item Les \textit{Traits}
  \item Assertion \`a la compilation
  \item Notion d'expression constante
  \item Maîtrise de la SFINAE
  \end{itemize}
  \end{block}
}

\frame
{
  \frametitle{\texttt{Traits}}

  \begin{block}{Objectifs}
  \begin{itemize}
  \item Introspection limitée sur les propriétés des types
  \item Génération de nouveaux types
  \item Outils pour la spécialisation avancée
  \item Notion de \textbf{méta-fonction} : fonction manipulant et retournant un type
  \end{itemize}
  \end{block}
}

\frame
{
  \frametitle{\texttt{Traits}}

  \begin{block}{Introspection}
  \begin{itemize}
  \item Classification des types selon leur sémantique
  \item Vérification d'existence d'une interface donnée
  \item Récupération d'informations structurelles
  \end{itemize}
  \end{block}

  \begin{block}{Exemple}
  \medskip
  \sourcecodecpplines{code/generic/introspection.cpp}{4}{15}
  \end{block}
}

\frame
{
  \frametitle{\texttt{Traits}}

  \begin{block}{Générateur de type}
  \begin{itemize}
  \item Manipulation sûre des qualificateurs
  \item Création de types vérifiant certaines propriétés
  \end{itemize}
  \end{block}

  \begin{block}{Exemple}
  \medskip
  \sourcecodecpp{code/generic/generation.cpp}
  \end{block}
}

\frame
{
  \frametitle{\texttt{Traits} -- Application}
  \sourcecodecpp{code/generic/traits_copy.cpp}
}

\frame
{
  \frametitle{\texttt{static\_assert}}

  \begin{block}{Objectifs}
  \begin{itemize}
  \item \texttt{assert} vérifie l'état logique d'un programme à l'exécution
  \item Comment vérifier l'état logique à la compilation ?
  \item Émission de messages d'erreur customisés
  \item Interaction avec les \textit{Traits}
  \end{itemize}
  \end{block}

  \begin{block}{Exemple}
  \medskip
  \sourcecodecpp{code/generic/staticassert.cpp}
  \end{block}
}

\frame
{
  \frametitle{Expressions Constantes}

  \begin{block}{Objectifs}
  \begin{itemize}
  \item Simplifier le développement de méta-fonctions numériques
  \item Syntaxe homogène aux fonctions classiques
  \item Utilisable dans les contextes requérant une constante
  \end{itemize}
  \end{block}

  \begin{block}{Syntaxe et Exemples}
  \begin{overlayarea}{\textwidth}{5cm}
  \only<1>{\sourcecodecpp{code/generic/factorialbefore.cpp}}
  \only<2>{\sourcecodecpp{code/generic/factorial.cpp}}
  \only<3>{\sourcecodecpp{code/generic/constfactorial.cpp}}
  \only<4>{\sourcecodecpp{code/generic/consterror.cpp}}
  \end{overlayarea}
  \end{block}
}

\frame
{
  \frametitle{Maîtrise de la SFINAE}
  \begin{block}{Qu'est-ce que la SFINAE ?}
  \begin{itemize}
  \footnotesize
  \item Lors de la r\'esolution de la surcharge de fonctions, il se peut qu'une 
  surcharge instancie une fonction \texttt{template}
  \item Cette instanciation peut \'echouer
  \item Au lieu d'émettre une erreur, la surcharge est ignor\'ee
  \item SFINAE = Substitution Failure Is Not An Error
  \end{itemize}
  \end{block}

  \begin{overlayarea}{\textwidth}{5cm}
  \only<1>{\sourcecodecpp{code/generic/sfinae.cpp}}
  \only<2>
  {
    \begin{block}{Intérêts}
    \begin{itemize}
    \footnotesize
    \item Contrôler ces erreurs permet d'éliminer des fonctions sur des critères
    arbitraires
    \item Customisation de la surcharge de fonctions ou de classes \texttt{templates}
    \item Interaction avec les \textit{Traits}
    \item \texttt{std::enable\_if}
    \end{itemize}
    \end{block}
  }
  \end{overlayarea}
}

\frame
{
  \frametitle{Maîtrise de la SFINAE}
  \sourcecodecpp{code/generic/enable_if.cpp}
}

\section{Tag Dispatching}
\begin{frame}
\frametitle{Tag Dispatching}
\begin{block}{Limitation de la SFINAE}
\begin{itemize}
\item Les conditions d'exclusion doivent être disjointes
\item Difficile à étendre hors des fonctions
\item La compilation est en $O(N)$ avec le nombre de cas
\end{itemize}
\end{block}

\begin{block}{Tag Dispatching}
\begin{itemize}
\item Catégorisation des types selon des familles de propriétés
\item Facile à étendre : une famille = un type
\item La sélection se fait via la surcharge normale
\end{itemize}
\end{block}
\end{frame}

\begin{frame}
\frametitle{Tag Dispatching -- \texttt{std::advance}}
\begin{overlayarea}{\textwidth}{10cm}
\only<1>{\lsttagdispatchingtag}
\only<2>{\lsttagdispatchingfunctioninput}
\only<3>{\lsttagdispatchingfunctionbi}
\only<4>{\lsttagdispatchingfunctionrandom}
\only<5>{\lsttagdispatchingfunctionmain}
\end{overlayarea}
\end{frame}

\end{document}
